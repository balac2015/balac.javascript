//
   Created by yu869 on 2015/10/27.

extends ../layouts/vendor
block header
  link(rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css")
  link(rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css")
//应用的page title
block pageTitle
  h1 加盟商添加学校
    small 添加学校
block main
  .box.box-primary
    .box-header.with-border
      h3.box-title 添加学校
    .panel-body
      div#storeEdit.row
        div.col-md-12
          form#franchiseeForm.form-signin.form-horizontal( action="/franchisee/upload" method="post" enctype="multipart/form-data" )
            h2.form-signin-heading 上传图片
            input#fulAvatar.form-control(name="fulAvatar" type="file")
            input#_csrf(type='hidden', name='_csrf', value=_csrf)
            button#btnSub.btn.btn-lg.btn-primary(type="submit" value="上 传") 上传


//应用添加的脚本在scripts block中定义
block scripts
  script(src='/plugins/select2/select2.full.js')
  script.
    $(document).ready(function () {

        $("#mgSubject").select2({
          minimumResultsForSearch: Infinity,
          allowClear: true,
          data:["代理商","学校自营","个人管理","其他"]
        });
      $("#others").hide();
      $("#mgSubject").on('change',function(){
       var mg= $(this).val();
        if(mg == "其他"){
          $("#others").show();
        }
      });
      $("#save").on('click',function(){
        $("#franchiseeForm").submit();
      });
        String.prototype.format = function (args) {
          var result = this;
          if (arguments.length > 0) {
            if (arguments.length == 1 && typeof (args) == "object") {
              for (var key in args) {
                if (args[key] != undefined) {
                  var reg = new RegExp("({" + key + "})", "g");
                  result = result.replace(reg, args[key]);
                }
              }
            }
            else {
                for (var i = 0; i < arguments.length; i++) {
                  if (arguments[i] != undefined) {
                    var reg = new RegExp("({)" + i + "(})", "g");
                    result = result.replace(reg, arguments[i]);
                  }
                }
             }
        }
        return result;
        }

        $(function(){
        $("#btnSub").on(click,function(){
          var fulAvatarVal = $("#fulAvatar").val(),
          errorTip = <div id="errorTip" class="alert alert-warning">{0}</div> ;

        $("#errorTip,#alt_warning").remove();

          if(fulAvatarVal.length == 0)
        {
        $("#container").prepend(errorTip.format("请选择要上传的文件"));
          return false;
        }

        var extName = fulAvatarVal.substring(fulAvatarVal.lastIndexOf('.'),fulAvatarVal.length).toLowerCase();

          if(extName != '.png' && extName != '.jpg'){
            $("#container").prepend(errorTip.format("只支持png和jpg格式图片"));
          return false;
        }

        return true;
        })
        })
    });

