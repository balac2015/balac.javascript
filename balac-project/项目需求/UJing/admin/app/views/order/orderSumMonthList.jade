extends ../layouts/default
block header
  link( rel="stylesheet" href="/plugins/datatables/dataTables.bootstrap.css")
  link( rel="stylesheet" href="/plugins/datepicker/datepicker3.css")

//应用的page title
block pageTitle
  h1 商家经营订单统计
    small 店铺统计列表
block main
  .box.box-primary
    .box-header.with-border
      h3.box-title 按店铺和月份查看订单统计报表
      a.btn.btn-xs.btn-default(href='/order/orderMFrancList' title='按加盟商查看统计')
        span 加盟商
      | &nbsp;
      a.btn.btn-xs.btn-default(href='/order/list' title='按日期查看统计')
        span 日期
      .box-tools.pull-right
        div.col-md-12
          div#datetimepicker.input-append.date.col-md-10
            input#createDate(type="text")
            span.add-on
              i.fa.fa-calendar
          div.col-md-2
            button#search.btn.btn-xs.btn-default(title='搜索')
              i.fa.fa-search
              span 搜索

    .box-body
      table#orderDayReportList.table.table-bordered.table-hover.table-striped(style="width:100%")
        thead
          th 年/月
          th 加盟商
          th 洗衣店
          th 总订单数
          th 预约订单数
          th 未支付订单数
          th 使用中订单数
          th 已完成订单数
          th 已取消订单数
          th 收入金额
          th 基准价
          th 实际收入

//应用添加的脚本在scripts block中定义
block scripts
    script(src='/plugins/datatables/jquery.dataTables.min.js')
    script(src='/plugins/datatables/dataTables.bootstrap.min.js')
    script(src='/plugins/datepicker/bootstrap-datepicker.js')
    script.
          $(document).ready(function () {
            $('#createDate').val("");
            var dates=$('#datetimepicker').datepicker({
              changeMonth: true,
              showButtonPanel: true,
              format: "yyyy-mm",
              language: 'cn',
              weekStart: 1,
              autoclose: true,
              todayBtn: 'linked'
            }).on('changeDate',function(ev){
              $('#createDate').val(ev.date);
            });
            var opts = {
              "language": {
                "url": "/plugins/datatables/Chinese.json"
              },
              autoWidth: true,
              select: true,
              searching: false,
              processing: true,
              serverSide: true,
              scrollX:true,
              ajax: {url: '/order/datatableMonth'},
              rowid: '_id',
              columnDefs: [

                //{targets: 0, visible: true, sortable: false, width: 40, searchable: false, defaultContent: ''},
              ]
            };
            var  Tdata=$('#orderDayReportList').dataTable(
                $.extend(opts,
                  {
                    order: [[1, 'asc']],
                    columns: [
                      {data: "month", defaultContent: '', render: function ( data, type, full, meta ) {
                        var b = moment(new Date(data));
                        var date = "";
                        if (data != null) {
                          date = b.format("YYYY-MM");
                        }
                        return date;
                      }},
                      {data: "franchiseeName", defaultContent: ''},
                      {data: "storeName", defaultContent: ''},
                      {data: "total", defaultContent: '0','class':'text-center'},
                      {data: "reservationNum", defaultContent: '0','class':'text-center'},
                      {data: "noPayNum", defaultContent: '0','class':'text-center'},
                      {data: "usingNum", defaultContent: '0','class':'text-center'},
                      {data: "completedNum", defaultContent: '0','class':'text-center'},
                      {data: "cancelNum", defaultContent: '0','class':'text-center'},
                      {data: "allowance", defaultContent: '0','class':'text-right',render: function ( data, type, full, meta ) {
                        return data.toFixed(2) + " 元";
                      }},
                      {data: "amount", defaultContent: '0','class':'text-right',render: function ( data, type, full, meta ) {
                        return data.toFixed(2) + " 元";
                      }},
                      {data: "realIincome", defaultContent: '0','class':'text-right',render: function ( data, type, full, meta ) {
                        return data ? data.toFixed(2) + " 元": "0.00 元";
                      }}
                    ]
                })
            );
            $('#search').on("click",function(e){
              var date=$('#createDate').val();
              var TT = $('#orderDayReportList').DataTable();
              TT.ajax.url('/order/datatableMonth?&dateText='+date).load();
            });
          })

