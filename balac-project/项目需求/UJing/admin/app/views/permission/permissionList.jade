//
   Created by danne on 2015/10/24.
extends ../layouts/default
block header
  link( rel="stylesheet" href="/plugins/datatables/dataTables.bootstrap.css")

//应用的page title
block pageTitle
  h1 系统权限管理
    small 添加，删除，更新系统中管理权限
block main
  .box
    .box-header.with-border
      h3.box-title 权限列表
      .box-tools.pull-right
        a.btn.btn-box-tool.btn-default(href="/system/permission/add")
          i.fa.fa-plus
          span  添加权限
        //button.btn.btn-box-tool(data-widget="collapse")
        //  i.fa.fa-minus
    .box-body
      table#permissionList.table.table-bordered.table-hover.table-striped
        thead
          //th.text-right(width="40") #
          th 权限名
          th 主体
          th 操作
          th URL
          th 描述
          th.text-center(width="80") 操作
        tbody

      form#permissionDelForm(method='post', style='display:none', action='/system/permission/del')
        input#ids(type='hidden',name='ids')
        input#_csrf(type='hidden', name='_csrf', value=_csrf)

//应用添加的脚本在scripts block中定义
block scripts
  script(src='/plugins/datatables/jquery.dataTables.min.js')
  script(src='/plugins/datatables/dataTables.bootstrap.min.js')
  script.
    $(function () {
      var opts = {
        "language": {
          "url": "/plugins/datatables/Chinese.json"
        },
        autoWidth: false,
        lengthChange: true,
        searching: true,
        processing: false,
        serverSide: true,
        deferRender: true,
        scrollX:true
      };
      var t = $('#permissionList').DataTable($.extend(opts, {
                ajax: {url: '/system/permission/datatable'},
                order: [[1, 'asc']],
                columnDefs: [
                  //{targets: 0, visible: true, sortable: false, searchable: false, defaultContent: ''},
                  {
                    targets: -1, visible: true, sortable: false, className: 'text-center',
                    render: function (data, type, row) {
                      return "<a class='btn btn-default btn-xs edit' href='/system/permission/edit?id=" + row._id + "'><i class='fa fa-edit'></i></a>"
                              + " <button class='btn btn-default btn-xs del' type='button'><i class='fa fa-trash-o'></i></button>";
                    }
                  }
                ],
                columns: [
                  //{data: ""},
                  {data: "name"},
                  {data: "subject"},
                  {data: "action"},
                  {data: "url"},
                  {data: "description", defaultContent: ''},
                  {data: ""}
                ]
              }
      ));
      $('#permissionList').on('click', 'button.del', function () {
        var id = t.row($(this).parents('tr')).data()._id;
        $("#permissionDelForm #ids").val(id);
        if (id) {
          bootbox.confirm("确定要删除数据吗?", function (result) {
            if (result) {
              $("#permissionDelForm").submit();
            }
          });
        }
      });
    });
